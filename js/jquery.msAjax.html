<!DOCTYPE html><html lang="en"><head><title>js\jquery.msAjax</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="js\jquery.msAjax"><meta name="groc-project-path" content="js\jquery.msAjax.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">js\jquery.msAjax.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="c1">/// &lt;reference path=&quot;../dependencies/json2.js&quot; /&gt;</span>
<span class="c1">/// &lt;reference path=&quot;date-parse.js&quot; /&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><a href="../index.html">Homepage</a> | 
<a href="https://github.com/labaneilers/SkinnyJS/blob/master/js/jquery.msAjax.js" target="_blank">View this file on Github</a> | 
<a href="https://raw.github.com/labaneilers/SkinnyJS/master/js/jquery.msAjax.js" target="_blank">Download this file</a>

<hr style="height: 1px; border:0; background-color:#4A525A">
<h2 id="jquerymsajax-plugin">jQuery.msAjax plugin</h2>

<p>Eases the pain of dealing with legacy Microsoft web services technologies (ASMX, WCF, JsonDataContractSerializer).</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>Correctly serializes/deserializes <a href="http://msdn.microsoft.com/en-us/library/bb299886.aspx#intro_to_json_sidebarb">Microsoft's date format</a> 
and revives dates into a JavaScript Date object.
** Supports ISO8601 dates as well.</li>
<li>Remove Microsoft specific JSON wrappers, including the "d" property, the embedded "__type" property</li>
<li>Wont do any of this if the JSON object isn't Microsoft-styled</li>
</ul></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p><strong>Note</strong>: This is not necessary when using ASP.NET MVC 4+ with Web API (which uses <a href="http://james.newtonking.com/projects/json-net.aspx">JSON.NET</a>) 
by default). WebAPI uses ISO8601 dates and doesn't add any Microsoft specific properties to JSON objects.</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="dependencies">Dependencies</h3>

<p>jQuery.msAjax has two dependencies:</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>date-parse.js (also part of skinny.js).</li>
</ul></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>For less-than-awesome browsers that don't support JSON.parse() or JSON.stringify(), you should include
a polyfill, such as <a href="https://github.com/douglascrockford/JSON-js/blob/master/json2.js">Doug Crockford's json2.js</a>. </li>
</ul></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="example-usage">Example Usage:</h3></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h4 id="asmx">ASMX</h4></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>$.msAjax({
    url: 'PersonWebService.asmx', 
    methodName: 'GetPerson', 
    data: {'personId': 1}, 
    success: function(oPerson) { alert(oPerson.Name); },
    error: function() { logSomething(arguments); }
});
</code></pre></div></div><div class="code"><div class="wrapper"> </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h4 id="wcf-rest-style">WCF (REST style)</h4></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>$.msAjax({
    url: 'PersonWebService.svc/People/1', 
    success: function(oPerson) { alert(oPerson.Name); },
    error: function() { logSomething(arguments); }
});
</code></pre></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="source">Source</h3></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span>
<span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Remove ASMX specific metadata from JSON</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">msJsonSanitizer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
    <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Rehydrate date values</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span>
        <span class="p">{</span>   
            <span class="k">return</span> <span class="nx">msJsonDateOnlySanitizer</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span>
        <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>ASMX adds a "__type" property to aid in return-trip deserialization.
This isn't useful most of the time.</p></div></div><div class="code"><div class="wrapper">            <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">__type</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">delete</span> <span class="nx">value</span><span class="p">.</span><span class="nx">__type</span><span class="p">;</span> 
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">};</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Converts date strings in ISO8601 or Microsoft format to JavaScript dates</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">msJsonDateOnlySanitizer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span>
        <span class="p">{</span>   </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Perform strict parsing so that strings that are not full dates are not parsed as dates
Example of a partial date:       "2013"
Example of a full ISO8601 date:  "2013-08-07T21:40:05.121+06:00"</p></div></div><div class="code"><div class="wrapper">            </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Depends on ms date parsing in js-iso8601-ms.js. True indicates to perform strict parsing.</p></div></div><div class="code"><div class="wrapper">            <span class="kd">var</span> <span class="nx">date</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parseISO8601</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> 
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">date</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nx">date</span><span class="p">;</span>
            <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Depends on ms date parsing in js-iso8601-ms.js. This function is already strict.</p></div></div><div class="code"><div class="wrapper">            <span class="nx">date</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parseMsDate</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> 
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">date</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nx">date</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Parses Microsoft JSON, removes the outer container, and revives it.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">$</span><span class="p">.</span><span class="nx">parseMsJSON</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">preserveType</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">text</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="p">{};</span>
        <span class="p">}</span>
        
        <span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">preserveType</span> <span class="o">?</span> <span class="nx">msJsonDateOnlySanitizer</span> <span class="o">:</span> <span class="nx">msJsonSanitizer</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">json</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="p">{};</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>ASMX puts all JSON in a "d" property.</p></div></div><div class="code"><div class="wrapper">        <span class="k">return</span> <span class="k">typeof</span> <span class="nx">json</span><span class="p">.</span><span class="nx">d</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span> <span class="nx">json</span><span class="p">.</span><span class="nx">d</span> <span class="o">:</span> <span class="nx">json</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Recurses through a JSON object and applies the specified reviver</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">recurseJSON</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">holder</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">reviver</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">holder</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">value</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> 
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">value</span><span class="p">)</span> 
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">k</span><span class="p">))</span> 
                <span class="p">{</span>
                    <span class="nx">v</span> <span class="o">=</span> <span class="nx">recurseJSON</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">reviver</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> 
                    <span class="p">{</span>
                        <span class="nx">value</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
                    <span class="p">}</span> 
                    <span class="k">else</span> 
                    <span class="p">{</span>
                        <span class="k">delete</span> <span class="nx">value</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">reviver</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">holder</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Recurses over a json data structure and runs the specified reviver function</p></div></div><div class="code"><div class="wrapper">    <span class="nx">$</span><span class="p">.</span><span class="nx">recurseJSON</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">reviver</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">recurseJSON</span><span class="p">({</span><span class="s2">&quot;&quot;</span><span class="o">:</span> <span class="nx">json</span><span class="p">},</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">reviver</span><span class="p">);</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Recurses over a json data structure output by Microsoft JSON serialization, and revives it.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">$</span><span class="p">.</span><span class="nx">reviveMsJSON</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">datesOnly</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">recurseJSON</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">datesOnly</span> <span class="o">?</span> <span class="nx">msJsonDateOnlySanitizer</span> <span class="o">:</span> <span class="nx">msJsonSanitizer</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">AJAX_SETTINGS_DEFAULTS</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">dataType</span><span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span>
            <span class="nx">contentType</span><span class="o">:</span> <span class="s2">&quot;application/json; charset=utf-8&quot;</span><span class="p">,</span>
            <span class="nx">converters</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;text json&quot;</span><span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseMsJSON</span> <span class="p">}</span> <span class="c1">//Parse and sanitize the JSON returned by ASMX</span>
        <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">validateSetting</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">settings</span><span class="p">,</span> <span class="nx">arg</span><span class="p">,</span> <span class="nx">methodName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">settings</span><span class="p">[</span><span class="nx">arg</span><span class="p">])</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">methodName</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nx">arg</span> <span class="o">+</span> <span class="s2">&quot; not specified&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">reISO</span> <span class="o">=</span> <span class="sr">/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/</span><span class="p">;</span> </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>A reviver/replacer for JSON.stringify() that converts dates into Microsoft format</p></div></div><div class="code"><div class="wrapper">    <span class="nx">$</span><span class="p">.</span><span class="nx">stringifyMsDate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> 
    <span class="p">{</span> 
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> 
        <span class="p">{</span> 
            <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">reISO</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> 
            <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span> 
                <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;/Date(&#39;</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">UTC</span><span class="p">(</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="mi">6</span><span class="p">])).</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;-0000)/&#39;</span><span class="p">;</span>

                <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span> 
                <span class="k">return</span> <span class="nx">val</span><span class="p">;</span> 
            <span class="p">}</span> 
        <span class="p">}</span> 
        <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Invoke $.ajax() with all the correct settings and wrappers for Microsoft script services such as ASMX and WCF.
Otherwise identical to $.ajax() (same settings, arguments, and return values).</p></div></div><div class="code"><div class="wrapper">    <span class="nx">$</span><span class="p">.</span><span class="nx">msAjax</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">settings</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">settings</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">settings</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">url</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">settings</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">url</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">settings</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Validate settings</p></div></div><div class="code"><div class="wrapper">        <span class="nx">validateSetting</span><span class="p">(</span><span class="nx">settings</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;$.ajaxAsmx&quot;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Format the data as JSON before post</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">settings</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">stringifyMsDate</span><span class="p">);</span> 
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>In ASMX (and REST in general), web service method name gets appended to the URL</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">methodName</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">settings</span><span class="p">.</span><span class="nx">url</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">methodName</span><span class="p">;</span> 
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">coalescedSettings</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">coalescedSettings</span><span class="p">,</span> <span class="nx">AJAX_SETTINGS_DEFAULTS</span><span class="p">,</span> <span class="nx">settings</span><span class="p">);</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Useful for testing invalid json</p></div></div><div class="code"><div class="wrapper">        <span class="cm">/*       </span>
<span class="cm">        settings.dataFilter = function(data, type)</span>
<span class="cm">        {</span>
<span class="cm">           return &quot;{d:{ &#39;foo&#39;: &#39;/Date(1325394000000-0500)/&#39; }}&quot;;</span>
<span class="cm">        };</span>
<span class="cm">        */</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>For a sync call, return the parsed JSON</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span><span class="nx">coalescedSettings</span><span class="p">.</span><span class="nx">async</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="nx">coalescedSettings</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseMsJSON</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">,</span> <span class="nx">coalescedSettings</span><span class="p">.</span><span class="nx">preserveType</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="nx">coalescedSettings</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">ajaxAsmx</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">msAjax</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajaxWcf</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">msAjax</span><span class="p">;</span>

<span class="p">})(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">jQuery</span><span class="p">);</span></div></div></div></div></body></html>