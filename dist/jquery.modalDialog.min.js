var DIALOG_TYPE_NODE="nodeDialog",DIALOG_TYPE_IFRAME="iframeDialog",DIALOG_TYPE_AJAX="ajaxDialog";Object.keys||(Object.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&(b[b.length]=c);return b}),function(a){function b(){if(d.ie7||d.ie8)return!1;var b=a(window);return("number"==typeof window.orientation?Math.min(b.width(),b.height()):b.width())<=480}function c(b){this.settings=b,this.parent=a(this.settings.containerElement||"body"),a.each(["open","beforeopen","close","beforeclose","ajaxerror"],a.proxy(this._setupCustomEvent,this));for(var c=["_drag","_startDrag","_stopDrag","_close"],d=0;d<c.length;d++)this[c[d]]=a.proxy(this[c[d]],this)}if(a.modalDialog&&a.modalDialog._isContent)throw new Error("Attempt to load jquery.modalDialogContent.js in the same window as jquery.modalDialog.js.");var d=window.ua=function(){var a=navigator.userAgent;return a.indexOf("MSIE 7.0")>0?{ie:!0,ie7:!0,version:7,compat:a.indexOf("compatible")>0}:a.indexOf("MSIE 8.0")>0?{ie:!0,ie8:!0,version:8,compat:a.indexOf("compatible")>0}:{}}(),e=10,f=600,g="-700px",h=[],i={},j=1e4,k={title:"",maxWidth:600,initialHeight:100,skin:"primary",ajax:!1,url:null,content:null,destroyOnClose:!1,containerElement:"body",preventEventBubbling:!0,onopen:null,onclose:null,onbeforeclose:null,onajaxerror:null},l=a.fn.transition?"transition":"animate",m=a.fn.transition?"out":"swing";a.isSmallScreen=b,c.prototype.dialogType=DIALOG_TYPE_NODE,c.prototype._setupCustomEvent=function(b,c){var d="on"+c,e=a.CustomEvent.create(this,c),f=this.settings[d];return f&&e.add(f),e},c.prototype.open=function(){if(!this._open){this.level=h.length;var c=this.onbeforeopen.fire();if(!c.isDefaultPrevented()&&(c=a.modalDialog.onbeforeopen.fire(null,this),!c.isDefaultPrevented()))return h.push(this),this._open=!0,this._build(),this.$container.stop()[b()?"addClass":"removeClass"]("smallscreen"),this.$el.show(),this._showLoadingIndicator(),this._finishOpenAction=function(){this.$bg.addClass(a.modalDialog.veilClass);var c=this._getDefaultPosition(),d=c.top;c.top=g,this.$container.css(c),this.$container[l]({top:d},f,m,a.proxy(function(){this.$el.addClass("dialog-visible"),b()&&(this._orientationchange=a.proxy(this.pos,this),a(window).on("orientationchange resize",this._orientationchange)),this.onopen.fire(),a.modalDialog.onopen.fire(null,this)},this)),this._hideLoadingIndicator()},this._finishOpen(),this}},c.prototype._finishOpen=function(){this._finishOpenAction&&(this._finishOpenAction(),this._finishOpenAction=null)},c.prototype._showLoadingIndicator=function(){this.$loadingIndicator||(this.$loadingIndicator=a("<div class='dialog-loading-indicator'><span></span></div>").appendTo(this.$bg).css("z-index",parseInt(this.$bg.css("z-index"),10)+1))},c.prototype._hideLoadingIndicator=function(){this.$loadingIndicator.remove(),this.$loadingIndicator=null},c.prototype.close=function(b){if(a.modalDialog.getCurrent()!==this)throw new Error("Can't close a dialog that isn't currently displayed on top.");var c={isDialogCloseButton:!!b};this.onbeforeclose.fire(c).isDefaultPrevented()||a.modalDialog.onbeforeclose.fire(c,this).isDefaultPrevented()||(a.modalDialog.getCurrent()===this&&h.pop(),this.$el.removeClass("dialog-visible"),this.$container[l]({top:g},f,m,a.proxy(this._finishClose,this,c)),this._orientationchange&&a(window).off("orientationchange resize",this._orientationchange))},c.prototype._close=function(a){a.preventDefault(),this.close(!0)},c.prototype._finishClose=function(b){this._open=!1,this.$bg.removeClass(a.modalDialog.veilClass),this.$el.hide(),this.settings.destroyOnClose&&(this._destroy(),this._destroyed=!0,delete i[this.settings._fullId]),this.onclose.fire(b),a.modalDialog.onclose.fire(b,this)},c.prototype._destroy=function(){this.$content.detach().appendTo("body"),this.$el.remove()},c.prototype._build=function(){if(this._destroyed)throw new Error("This dialog has been destroyed");this.$el?this._alreadyBuilt():(this.$bg=a('<div class="dialog-background"></div>').css("z-index",++j),j++,this.$container=a('<div class="dialog-container" id="'+this.settings._fullId+'Container">'+'  <div class="dialog-header">'+"    <h1>"+this.settings.title+"</h1>"+'    <a href="#" class="dialog-close-button"><span class="dialog-close-button-icon"></span></a>'+"  </div>"+'  <div class="dialog-content-container">'+"  </div>"+"</div>").css("z-index",++j),this.$el=a([this.$bg[0],this.$container[0]]).addClass("dialog-skin-"+this.settings.skin),this.parent.append(this.$bg,this.$container),this.parent.is("body")||this.parent.hasClass("ui-page-active")||(this.$bg.css("position","absolute"),"static"==this.parent.css("position")&&this.parent.css("position","relative")),this.$contentContainer=this.$el.find(".dialog-content-container"),this.$header=this.$el.find(".dialog-header"),this.$closeButton=this.$el.find(".dialog-close-button").on("click",this._close),this._buildContent(),this.$content.find('*[data-action="close"]').on("click",this._close),this.$contentContainer.append(this.$content),!this.parent.is("body")&&!this.parent.hasClass("ui-page-active")||d.ie7||this._makeDraggable())},c.prototype._alreadyBuilt=function(){},c.prototype._getChromeHeight=function(){return this._chromeHeight||(this._chromeHeight=this.$container.height()-this.$content.height()),this._chromeHeight},c.prototype._getDefaultPosition=function(c){var f=a(window),g=this.parent.is("body")?window.innerWidth||f.width():this.parent.width(),h={};if(h.width=Math.min(g-2*e,this.settings.maxWidth),h.top=a(document).scrollTop()+e,h.left=(g-h.width)/2,d.ie7&&(h.top=e),b())"lightbox"==this.settings.skin&&(h.width="100%",h.left=0);else{c=c||this.$content.height();var i=this._getChromeHeight()+c,j=this.parent.height()/2-i/2;h.top=Math.max(j,h.top)}return h},c.prototype._makeDraggable=function(){b()||this.$header.addClass("draggable").on("mousedown touchstart",this._startDrag)},c.prototype._startDrag=function(b){var c=a(b.target);if(!c.is(this.$closeButton)&&!c.is(this.$closeButton.children())){if(b.stopPropagation(),b.preventDefault(),this._initialMousePos=n(b),this._initialDialogPos=this.$container.offset(),this.$container.on("mousemove touchmove",this._drag),this.$bg.on("mouseup touchend",this._stopDrag),this.$container.on("mouseup touchend",this._stopDrag),this.$frame)try{this.$frame.iframeDocument().find("body").on("mousemove touchmove",this._drag).on("mouseup touchend",this._stopDrag)}catch(d){}this._parentRect=this.$el.clientRect(),this._isDragging=!0}},c.prototype._drag=function(a){a.preventDefault(),a.stopPropagation();var b=n(a),c=b.top-this._initialMousePos.top,d=b.left-this._initialMousePos.left,e={top:this._initialDialogPos.top+c,left:this._initialDialogPos.left+d};this.$container.css(e)},c.prototype._stopDrag=function(a){if(this._initialMousePos=null,this._initialDialogPos=null,a.stopPropagation(),a.preventDefault(),this.$el.off("mousemove touchmove",this._drag),this.$el.off("mouseup touchend",this._stopDrag),this.$container.off("mouseup touchend",this._stopDrag),this.$frame)try{this.$frame.iframeDocument().find("body").off("mousemove touchmove",this._drag).off("mouseup touchend",this._stopDrag)}catch(b){}this._isDragging=!1};var n=function(b){var c=b.originalEvent.touches;c&&c.length>=0&&(b=c.item(0));var d={left:b.clientX,top:b.clientY};if(b.target.ownerDocument!=window.document){var e=a(b.target.ownerDocument).hostIframe();if(e.length>0){var f=e.clientRect();d.top+=f.top,d.left+=f.left}}return d};c.prototype._buildContent=function(){this.$content=a(this.settings.content),this.$content.detach()},c.prototype.getWindow=function(){return window},c.prototype.getParent=function(){return this.settings.parentId?u(this.settings.parentId):null},c.prototype.center=function(){var a=this._getDefaultPosition();this.$container[l]({top:a.top},400)},c.prototype.pos=function(a){this.$container.stop();var b=this._getDefaultPosition();if(a===!0){var c=b.top;delete b.top,this.$container.css(b)[l]({top:c},400)}else this.$container.css(b)},c.prototype.setTitle=function(a){this.$container.find(".dialog-header h1").text(a)};var o=function(){c.apply(this,arguments),this.settings.parentId&&(this._parentWindow=window.frames[this.settings.parentId])};a.extend(o.prototype,c.prototype),o.prototype.dialogType=DIALOG_TYPE_IFRAME,o.prototype._setupCustomEvent=function(){var a=c.prototype._setupCustomEvent.apply(this,arguments);a.add(p)};var p=function(b){for(var c=0;c<h.length;c++)h[c]._postMessageToContent("event"+b.type,a.extend({_eventDialogId:this.settings._fullId},b.data))};o.prototype._finishClose=function(a){c.prototype._finishClose.call(this,a),this.$frame.remove()},o.prototype._destroy=function(){this.$el.remove()},o.prototype._buildContent=function(){this.$frame=a('<iframe src="'+this.settings.url+'" name="'+this.settings._fullId+'" seamless allowtransparency="true" width="100%" style="height:'+this.settings.initialHeight+'px;" class="dialog-frame" scrolling="no" frameborder="0" framespacing="0" />'),this.$content=this.$frame},o.prototype._alreadyBuilt=function(){this.$frame,this._buildContent(),this.$contentContainer.append(this.$content)},o.prototype.getWindow=function(){return this.$frame.iframeWindow()[0]},o.prototype._postMessageToContent=function(b,c){var d={dialogCmd:b};c&&a.extend(d,c);var e=this.getWindow(),f=a.param(d),g=this.settings.frameHostname;g||(g=0===this.settings.url.indexOf("http")?this.settings.url:document.location.href),a.postMessage?a.postMessage(f,g,e):e.postMessage(f,"*")},o.prototype.setHeight=function(b,c,d){var f=a(window).height()-2*e;f-this._getChromeHeight();var g=d?function(a,b){a.css(b)}:function(a,b){a.animate(b,{duration:400})};if(g(this.$content,{height:b}),c){var h=this._getDefaultPosition(b);g(this.$content,{top:h.top})}this.settings.initialHeight=b},o.prototype.setHeightFromContent=function(a,b){this._postMessageToContent("setHeightFromContent",{center:!!a,skipAnimation:!!b})},o.prototype.setTitleFromContent=function(){this._postMessageToContent("setTitleFromContent")},o.prototype.notifyReady=function(a){this.settings.frameHostname=a,c.prototype._finishOpen.apply(this)},o.prototype._finishOpen=function(){};var q=function(){c.apply(this,arguments)};a.extend(q.prototype,c.prototype),q.prototype.dialogType=DIALOG_TYPE_AJAX,q.prototype.open=function(){c.prototype.open.apply(this,arguments),this._ajaxComplete?c.prototype._finishOpen.call(this):this.$content.partialLoad(this.settings.url,null,a.proxy(function(a,b,d){this._ajaxComplete=!0,d.isRejected()&&this.onajaxerror.fire({xhr:d,status:b,responseText:a}),c.prototype._finishOpen.call(this)},this))},q.prototype._finishOpen=function(){},q.prototype._buildContent=function(){this.$content=a("<div class='dialog-content'></div>")},q.prototype._destroy=function(){this.$el.remove()};var r=-1,s="dialog",t=function(b){var c=a.extend({},k);if(b.content){var d=a(b.content).data();a.each(Object.keys(k),function(a,b){b in d&&(c[b]=d[b])})}a.extend(c,b);var e;if(c._fullId){var f=c._fullId.split("_");e=f.pop(),f.length>0&&(c.parentId=f.join("_"))}else{e=s+(c.id||++r);var g=c.parentId?c.parentId+"_":"";c._fullId=g+e}return c},u=function(a){return i[a]};a.modalDialog={},a.modalDialog._isHost=!0,a.modalDialog.veilClass=b()?"dialog-veil-opaque":"dialog-veil",a.modalDialog.create=function(b){b=t(b);var d=u(b._fullId);if(!d&&b.content&&(d=a(b.content).modalDialogInstance()),!d){if(b.url){if(b.content)throw new Error("Both url and content cannot be specified.");d=b.ajax?new q(b):new o(b)}else{if(!b.content)throw new Error("No url or content node specified");d=new c(b),b.destroyOnClose||a(b.content).modalDialogInstance(d)}i[b._fullId]=d}return d},a.modalDialog.getCurrent=function(){return h.length>0?h[h.length-1]:null},a.CustomEvent.create(a.modalDialog,"beforeopen"),a.CustomEvent.create(a.modalDialog,"open"),a.CustomEvent.create(a.modalDialog,"beforeclose"),a.CustomEvent.create(a.modalDialog,"close");var v="modalDialog";a.fn.modalDialogInstance=function(a){return a?this.data(v,a):this.data(v)},a.fn.modalDialog=function(b){var c;if("string"==typeof b){var d=b;c=this.modalDialogInstance(),c&&c[d]&&c[d].apply(c,Array.prototype.slice(arguments,1))}else b=b||{},b.content=this[0],c=a.modalDialog.create(b),c.open();return this};var w={setHeight:function(a,b){a.setHeight(parseInt(b.height,10),"true"===b.center,"true"===b.skipAnimation)},setTitle:function(a,b){a.setTitle(b.title)},open:function(a){a.open()},close:function(a){a.close()},create:function(){},center:function(a){a.center()},notifyReady:function(a,b){a.notifyReady(b.hostname)}},x=function(b){var c;try{c=a.deparam(b.originalEvent?b.originalEvent.data:b.data)}catch(d){}if(c.dialogCmd){var e=w[c.dialogCmd];if(e){var f;f=c._fullId?a.modalDialog.create(c):a.modalDialog.getCurrent(),e(f,c)}}};a.receiveMessage?a.receiveMessage(x,"*"):a(window).on("message",x),window._dialogReceiveMessageManual=function(a,b){x({data:a,origin:b})},a(document).ready(function(){a.mobile&&(k=a.extend(k,{preventEventBubbling:!1}))})}(jQuery),function(a){if(a.isSmallScreen()){a.modalDialog.veilClass="dialog-veil-opaque";var b=function(b,c){b.dialogType==DIALOG_TYPE_IFRAME&&a([window,document]).enableEvent("touchmove touchstart touchend",!c)},c="androidDialogShim",d="[data-dialog-main-panel='true']",e="[data-dialog-hide-onopen='true']",f=function(b,d){b.each(function(b,e){var f=a(e),g=f.data(c);g||(g=a("<div style='display:none;'></div>"),f.before(g),f.data(c,g)),d?(g.css({height:f.height(),width:f.width()}).show(),f.hide()):(f.show(),g.hide())})},g=function(){var b=a(d);0===b.length&&(b=a(e)),b.length>0&&(a.modalDialog.onopen.add(function(){0===this.level&&f(b,!0)}),a.modalDialog.onbeforeclose.add(function(){0===this.level&&f(b,!1)}))};a(function(){if(a.modalDialog&&a.modalDialog._isContent){var c=a.modalDialog.getCurrent();c&&a(window).on("load",function(){b(c,!0)})}else a.modalDialog.onopen.add(function(){b(this,!0)}),a.modalDialog.onbeforeclose.add(function(){b(this,!1)}),g()})}}(jQuery),function(a){var b="data-dialog-",c=function(a){return a||null},d=function(a){if(a)switch(a=a.toString().toLowerCase()){case"true":case"yes":case"1":return!0}return!1},e=function(a){return a?new Function("event",a):null},f=[["title",c],["onopen",e],["onbeforeopen",e],["onclose",e],["onbeforeclose",e],["maxWidth",parseInt],["initialHeight",parseInt],["ajax",d],["onajaxerror",e],["destroyOnClose",d],["skin",c]],g=function(a,c){for(var d=0;d<f.length;d++){var e=f[d][0],g=f[d][1],h=a.attr(b+e);h=g(h),h&&(c[e]=h)}},h="modalDialogUnobtrusive",i=function(b){var c=a(b.target),d=c.data(h);if(!d){var e=c.attr("href");if(!e)throw new Error("no href specified with data-rel='modalDialog'");b.preventDefault();var f,i={};try{f=a(e)}catch(j){}f&&f.length>0?(i.content=f,g(f,i)):i.url=e,g(c,i);var k=new a.Event("dialogsettingscreate");if(k.dialogSettings=i,c.trigger(k),k.isDefaultPrevented())return;if(d=a.modalDialog.create(i),k=new a.Event("dialogcreate"),k.dialogSettings=i,k.dialog=d,c.trigger(k),k.isDefaultPrevented())return;c.data(h,d)}d.open()};a(document).ready(function(){a("[data-rel='modalDialog']").on("click",i)})}(jQuery);